#![allow(dead_code)]
pub mod error_codes;
pub use error_codes::LeptonResult;

#[cfg(test)]
mod tests;

pub mod types;

// Autogenerated Bindings
#[allow(non_upper_case_globals)]
#[allow(non_camel_case_types)]
#[allow(non_snake_case)]
#[allow(dead_code)]
#[link(name = "lepton")]
pub mod bindings {
    include!(concat!(env!("OUT_DIR"), "/bindings.rs"));
}

#[derive(Debug, Clone, Copy)]
#[repr(u32)]
pub enum PortTag {
    CciTwi = bindings::LEP_CAMERA_PORT_E_TAG_LEP_CCI_TWI, 
    CciSpi = bindings::LEP_CAMERA_PORT_E_TAG_LEP_CCI_SPI, 
    End    = bindings::LEP_CAMERA_PORT_E_TAG_LEP_END_CCI_PORTS, 
}

impl std::convert::From<u32> for PortTag {
    fn from(tag: u32) -> Self {
        match tag {
            bindings::LEP_CAMERA_PORT_E_TAG_LEP_CCI_TWI => PortTag::CciTwi,
            bindings::LEP_CAMERA_PORT_E_TAG_LEP_CCI_SPI => PortTag::CciSpi,
            _ => panic!("Invalid Port Tag!"),
        }
    }
}

#[derive(Debug, Clone, Copy)]
#[repr(C)]
pub struct CameraPortDescriptor {
    port_id:   u16,
    port_type: PortTag,
    baud_rate: u16,
    dev_addr:  u8,
}

impl CameraPortDescriptor {
    fn new() -> Self {
        CameraPortDescriptor {
            port_id:   0,
            port_type: PortTag::CciTwi,
            baud_rate: 0,
            dev_addr:  0x2A
        }
    }
}

impl std::convert::From<bindings::LEP_CAMERA_PORT_DESC_T_TAG> for CameraPortDescriptor {
    fn from(desc: bindings::LEP_CAMERA_PORT_DESC_T_TAG) -> Self {
        CameraPortDescriptor {
            port_id:   desc.portID,
            port_type: desc.portType.into(),
            baud_rate: desc.portBaudRate,
            dev_addr:  desc.deviceAddress,
        }
    }
}

